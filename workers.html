<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>PROSTAFF ‚Äî Kunlik ishchilar</title>
  <link rel="manifest" href="manifest.json">
  <style>
    :root{--brand:#f59e0b;--ink:#111827;--bg:#fff;--muted:#6b7280;--border:#eee;--card:#f9fafb;--radius:12px}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,Inter,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink)}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border)}
    .bar{max-width:880px;margin:auto;padding:14px 16px;display:flex;align-items:center;gap:10px}
    .back{text-decoration:none;font-size:22px}
    .title{font-weight:900}
    main{max-width:880px;margin:18px auto 90px;padding:0 16px}
    fieldset{border:1px solid var(--border);border-radius:var(--radius);padding:14px;background:var(--card)}
    legend{padding:0 6px;color:var(--muted)}
    label{display:block;font-size:13px;color:var(--muted);margin:12px 0 6px}
    input,select,textarea{width:100%;padding:12px 10px;border:1px solid var(--border);border-radius:10px;background:#fff}
    .row{display:grid;gap:12px}@media(min-width:640px){.row{grid-template-columns:1fr 1fr}}
    .qty{display:flex;gap:10px;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;font-weight:800;cursor:pointer}
    .btn.brand{background:var(--brand);color:#fff;border-color:var(--brand)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff}
    .note{margin-top:10px;color:var(--muted);font-size:13px}
    nav{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border)}
    .tabs{max-width:880px;margin:auto;display:flex;justify-content:space-around;padding:10px 8px}
    .tab{display:flex;flex-direction:column;align-items:center;gap:6px;color:#6b7280;text-decoration:none;font-size:12px}
    .tab .i{font-size:22px}.tab.active{color:#111827;font-weight:800}
    .offers{margin-top:14px;border:1px solid var(--border);background:#fff;border-radius:12px;padding:12px}
    .offer{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:10px;padding:10px;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <a class="back" href="index.html">‚Üê</a>
      <div class="title">Kunlik ishchilar</div>
    </div>
  </header>

  <main>
    <fieldset>
      <legend>Qanday ishlaydi?</legend>
      <div class="note">Xizmat turini tanlang ‚Üí manzil, sana/vaqt, rasm(lar) ‚Üí e‚Äôlon ketadi. Faqat rozi bo‚Äòlgan ishchilar taklif yuboradi. Siz mosini tanlaysiz.</div>
    </fieldset>

    <form id="order" onsubmit="submitForm(event)" autocomplete="on">
      <label>Xizmat turi *</label>
      <select id="type" required>
        <option>Yuvish</option>
        <option>Remontdan keyingi tozalash</option>
        <option>Oyna/pol yuvish</option>
        <option>Yuk ko‚Äòtarish</option>
        <option>Ko‚Äòchirish (gazel+brigada)</option>
        <option>Usta (elektrik/santexnik)</option>
        <option>Boshqa</option>
      </select>

      <div class="row">
        <div>
          <label>Shahar *</label>
          <select id="city" required>
            <option>Toshkent</option><option>Namangan</option><option>Andijon</option>
            <option>Farg‚Äòona</option><option>Qarshi</option><option>Buxoro</option>
          </select>
        </div>
        <div>
          <label>Sana *</label>
          <input type="date" id="date" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Manzil (aniq joy) *</label>
          <input type="text" id="addr" placeholder="Chilonzor-3, 12-uy..." required>
        </div>
        <div>
          <label>Vaqt *</label>
          <input type="time" id="time" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Necha soat</label>
          <div class="qty">
            <button class="btn" type="button" onclick="chg(-1)">‚Äì</button>
            <input id="hours" type="number" value="2" min="1" max="12">
            <button class="btn" type="button" onclick="chg(1)">+</button>
          </div>
        </div>
        <div>
          <label>Rasm(lar) (ixtiyoriy)</label>
          <input type="file" id="photos" accept="image/*" multiple>
        </div>
      </div>

      <label>Qo‚Äòshimcha izoh</label>
      <textarea id="note" rows="3" placeholder="kv.m, orientir, kalit, hayvon, lift yo‚Äòq va hokazo"></textarea>

      <div class="note" style="margin-top:10px">üìç GPS: <span id="gps">‚Äî</span></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
        <button class="btn" type="button" onclick="getGPS()">GPS olish</button>
        <button class="btn" type="button" onclick="viewOffers()">Tushgan takliflar</button>
        <button class="btn brand" type="submit">Buyurtmani yuborish</button>
      </div>

      <div class="note">Eslatma: ishchilar ro‚Äòyxati faqat e‚Äôlon bergan vaqtingizda, taklif yuborganlar ichida ko‚Äòrinadi.</div>
    </form>

    <div id="offersBox" class="offers" style="display:none">
      <b>Tushgan takliflar</b>
      <div id="offers"></div>
    </div>
  </main>

  <nav>
    <div class="tabs">
      <a class="tab" href="index.html"><span class="i">üè†</span><span>Bosh</span></a>
      <a class="tab active" href="workers.html"><span class="i">üë∑</span><span>Ishchi</span></a>
      <a class="tab" href="firms.html"><span class="i">üè¢</span><span>Firma</span></a>
      <a class="tab" href="#my"><span class="i">üì¨</span><span>Takliflar</span></a>
    </div>
  </nav>

  <script>
    const LS_KEY='prostaff_orders', OFFERS_KEY='prostaff_offers';
    function chg(d){ const el=hours; el.value=Math.min(12,Math.max(1,(+el.value||1)+d)); }
    function getGPS(){
      const el=gps;
      if(!navigator.geolocation){ el.textContent='Qurilmada GPS yo‚Äòq'; return; }
      navigator.geolocation.getCurrentPosition(
        p=>{ el.textContent = p.coords.latitude.toFixed(5)+', '+p.coords.longitude.toFixed(5); },
        _=>{ el.textContent='Ruxsat berilmadi'; }
      );
    }
    function submitForm(e){
      e.preventDefault();
      const order = {
        type: type.value, city: city.value, date: date.value,
        addr: addr.value, time: time.value, hours: hours.value, note: note.value,
        gps: gps.textContent
      };
      const all = JSON.parse(localStorage.getItem(LS_KEY)||'[]'); all.unshift(order);
      localStorage.setItem(LS_KEY, JSON.stringify(all));
      // demo offers
      const names=['Jasur','Umid','Dilshod','Aziza','Sardor','Bekzod'];
      const offers = Array.from({length:Math.floor(Math.random()*3)+2}).map((_,i)=>({
        id:'w'+(Date.now()+i), name:names[Math.floor(Math.random()*names.length)],
        rating:(4+Math.random()).toFixed(1), price:(150+Math.floor(Math.random()*80))+' ming/soat',
        eta:(5+Math.floor(Math.random()*8))+' daq'
      }));
      localStorage.setItem(OFFERS_KEY, JSON.stringify(offers));
      alert('Buyurtma yuborildi! Yaqinda takliflar tushadi.');
      viewOffers();
    }
    function viewOffers(){
      const data = JSON.parse(localStorage.getItem(OFFERS_KEY)||'[]');
      const box = document.getElementById('offersBox'), list=document.getElementById('offers');
      if(!data.length){ alert('Hozircha taklif yo‚Äòq.'); return; }
      box.style.display='block'; list.innerHTML='';
      data.forEach(of=>{
        const d=document.createElement('div'); d.className='offer';
        d.innerHTML=`<div><b>${of.name}</b> ¬∑ ‚≠ê ${of.rating}<br><span style="color:#16a34a">${of.price}</span> ¬∑ ${of.eta}</div>
                     <button class="btn brand" onclick="choose('${of.id}')">Tanlash</button>`;
        list.appendChild(d);
      });
    }
    function choose(id){
      const data = JSON.parse(localStorage.getItem(OFFERS_KEY)||'[]');
      const of = data.find(x=>x.id===id); if(!of) return;
      alert(`${of.name} tanlandi. Bog‚Äòlanish yuborildi!`);
      localStorage.removeItem(OFFERS_KEY);
      document.getElementById('offers').innerHTML='';
      document.getElementById('offersBox').style.display='none';
    }

    // Always-fresh SW
    if ('serviceWorker' in navigator) {
      const v = Date.now();
      navigator.serviceWorker.getRegistrations()
        .then(rs => Promise.all(rs.map(r => r.unregister())))
        .then(() => navigator.serviceWorker.register('service-worker.js?v=' + v, {scope: './'}))
        .catch(()=>{});
    }
  </script>
</body>
</html>
