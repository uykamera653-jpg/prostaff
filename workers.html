<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>PROSTAFF ‚Äî Kunlik ishchilar</title>
<meta name="theme-color" content="#f59e0b" />
<link rel="manifest" href="manifest.json" />
<style>
  :root{--ink:#0f172a;--muted:#475569;--bg:#fff;--panel:#f9fafb;--ok:#16a34a;--warn:#f59e0b;--err:#ef4444}
  *{box-sizing:border-box} html,body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  body{background:#fff;color:var(--ink)}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e5e7eb;z-index:10}
  .title{padding:16px;text-align:center;font-weight:900;font-size:22px}
  .wrap{max-width:900px;margin:0 auto;padding:16px 16px 120px}
  .card{background:var(--panel);border-radius:16px;padding:14px;margin:12px 0}
  .field{display:flex;flex-direction:column;gap:6px;margin:8px 0}
  .label{font-size:13px;font-weight:700}
  .req{color:#ef4444}
  .help{font-size:12px;color:var(--muted)}
  .errbox{border:1px solid var(--err);color:#b00000;background:#fff;border-radius:12px;padding:10px;margin:8px 0;display:none}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:680px){.grid{grid-template-columns:1fr 1fr}}
  .item{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:12px;display:flex;gap:12px}
  .avatar{width:60px;height:60px;border-radius:12px;border:1px solid #e5e7eb;display:grid;place-items:center;font-size:26px}
  .meta{flex:1}.meta h4{margin:2px 0 6px}
  .badge{font-size:12px;border:1px solid #e5e7eb;border-radius:999px;padding:3px 10px;margin-right:6px;background:#fff;color:#334155}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .btn{border:none;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
  .primary{background:#111;color:#fff}.ghost{background:#f1f5f9}.success{background:var(--ok);color:#fff}
  .thumbs{display:flex;gap:8px;flex-wrap:wrap}.thumbs img{width:70px;height:70px;border-radius:10px;border:1px solid #e5e7eb;object-fit:cover}
  nav{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #e5e7eb;padding:12px}
  .nav{display:flex;justify-content:space-between}
  .nav a{display:grid;place-items:center;width:56px;height:56px;border:1px solid #e5e7eb;border-radius:16px;text-decoration:none}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:86px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 8px 24px #0005;opacity:0;transition:.25s}
  .toast.show{opacity:1}
  .stepper{display:flex;align-items:center;gap:8px}
  .stepper button{width:40px;height:40px;border-radius:10px;border:1px solid #e5e7eb;background:#fff}
</style>
</head>
<body>
<header><div class="title">PROSTAFF ‚Äî Kunlik ishchilar</div></header>
<main class="wrap">
  <div class="card"><b>Qanday ishlaydi?</b><br>
    Xizmat turini tanlang ‚Üí manzil, sana/vaqt, GPS va rasm(lar)ni kiriting ‚Üí e‚Äôlon yuboriladi ‚Üí yaqin ishchilardan <i>faqat rozi bo‚Äòlganlari</i> taklif yuboradi ‚Üí siz ulardan birini tanlaysiz.
  </div>

  <h3>Buyurtma ‚Äî ishchi</h3>
  <div id="err" class="errbox"></div>

  <div class="field">
    <div class="label">Xizmat turi <span class="req">*</span></div>
    <select id="svc">
      <option value="yuvish">Yuvish</option>
      <option value="remont_clean">Remontdan keyingi tozalash</option>
      <option value="general_clean">General tozalash</option>
      <option value="window">Oyna yuvish</option>
      <option value="carpet">Gilam yuvish</option>
      <option value="laundry">Kiyim yuvish</option>
      <option value="yuk">Yuk tashish</option>
      <option value="boshqa">Boshqa</option>
    </select>
  </div>

  <div class="field">
    <div class="label">Shahar <span class="req">*</span></div>
    <select id="city">
      <option>Toshkent</option><option>Samarqand</option><option>Buxoro</option><option>Andijon</option><option>Namangan</option>
    </select>
  </div>

  <div class="field">
    <div class="label">Manzil (aniq joy) <span class="req">*</span></div>
    <div style="display:flex;gap:8px">
      <input id="addr" placeholder="Masalan: Chilonzor-3, 12-uy, 45-xon." style="flex:1">
      <button class="btn ghost" id="gpsBtn" type="button">GPS</button>
    </div>
    <div class="help" id="gpsHint">GPS: ‚Äì</div>
  </div>

  <div class="field">
    <div class="label">Sana va vaqt <span class="req">*</span></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input id="date" type="date"><input id="time" type="time">
    </div>
  </div>

  <div class="field">
    <div class="label">Necha soat</div>
    <div class="stepper">
      <button id="minus">‚àí</button>
      <input id="hours" type="number" min="1" max="12" value="2" style="width:90px;text-align:center">
      <button id="plus">+</button>
    </div>
  </div>

  <div class="card">
    <b>Rasm(lar) (ixtiyoriy)</b>
    <input id="imgs" type="file" accept="image/*" multiple style="margin-top:8px">
    <div class="help">8 ta, har biri ‚â§5MB</div>
    <div id="previews" class="thumbs"></div>
  </div>

  <div class="field">
    <div class="label">Qo‚Äòshimcha izoh</div>
    <textarea id="note" rows="3" placeholder="Kv.m, kalit/eshik, uy hayvoni va b."></textarea>
  </div>

  <div class="actions">
    <button class="btn ghost" id="toOffers" disabled title="Avval buyurtma yarating">Tushgan takliflar</button>
    <button class="btn primary" id="send">Buyurtmani yuborish</button>
  </div>

  <hr style="margin:18px 0;border:0;border-top:1px solid #e5e7eb">
  <h3>Tushgan takliflar</h3>
  <div id="offersEmpty" class="help">Hozircha taklif yo‚Äòq.</div>
  <section id="offers" class="grid"></section>
</main>

<nav>
  <div class="nav">
    <a href="./index.html" title="Bosh sahifa">üè†</a>
    <a href="./firms.html" title="Firmalar">üè¢</a>
    <a href="./workers.html" title="Ishchilar" style="background:#111;color:#fff">üßë‚Äçüîß</a>
  </div>
</nav>

<div id="toast" class="toast">OK</div>

<script>
/* Utils */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
function toast(m){const t=$('#toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500)}
const tagSvc = v=>({yuvish:'Yuvish',remont_clean:'Remontdan keyingi tozalash',general_clean:'General tozalash',window:'Oyna yuvish',carpet:'Gilam yuvish',laundry:'Kiyim yuvish',yuk:'Yuk tashish',boshqa:'Boshqa'})[v]||v;
const toMoney = n => (n||0).toLocaleString('uz-UZ');

/* Mock data (ishchilar katalogi) */
const WORKERS=[
  {id:'w1',name:'Farangiz',cat:'yuvish',rating:4.8,city:'Toshkent',price:90000,unit:'/soat'},
  {id:'w2',name:'Jamshid',cat:'remont_clean',rating:4.7,city:'Toshkent',price:250000,unit:'/soat'},
  {id:'w3',name:'Akbar',cat:'yuk',rating:4.5,city:'Samarqand',price:120000,unit:'/soat'},
  {id:'w4',name:'Aziza',cat:'general_clean',rating:4.9,city:'Toshkent',price:100000,unit:'/soat'},
  {id:'w5',name:'Bekzod',cat:'window',rating:4.6,city:'Toshkent',price:110000,unit:'/soat'},
];

/* State */
let GPS=null, uploads=[], CURRENT_ORDER=null;

/* Form helpers */
$('#minus').onclick=()=>{const i=$('#hours');i.value=Math.max(1,(+i.value||1)-1)}
$('#plus').onclick=()=>{const i=$('#hours');i.value=Math.min(12,(+i.value||1)+1)}

$('#imgs').addEventListener('change',e=>{
  uploads.length=0; $('#previews').innerHTML='';
  const files=[...e.target.files];
  const MAX=8, LIM=5*1024*1024;
  files.slice(0,MAX).forEach(f=>{
    if(f.size>LIM){toast(`${f.name}: 5MB dan katta`);return}
    const r=new FileReader(); r.onload=ev=>{
      uploads.push(ev.target.result);
      const im=new Image(); im.src=ev.target.result; im.width=70; im.height=70; im.style.objectFit='cover';
      $('#previews').appendChild(im);
    }; r.readAsDataURL(f);
  });
});

$('#gpsBtn').onclick=()=>{
  if(!navigator.geolocation){$('#gpsHint').textContent='GPS: qurilma qo‚Äòllamaydi';return}
  navigator.geolocation.getCurrentPosition(pos=>{
    GPS={lat:pos.coords.latitude,lng:pos.coords.longitude};
    $('#gpsHint').innerHTML=`GPS: ${GPS.lat.toFixed(5)}, ${GPS.lng.toFixed(5)} ¬∑ <a target="_blank" href="https://maps.google.com/?q=${GPS.lat},${GPS.lng}">Xaritada</a>`;
  },_=>$('#gpsHint').textContent='GPS: ruxsat berilmadi');
};

function validate(){
  const need=[]; if(!$('#svc').value)need.push('Xizmat turi'); if(!$('#city').value)need.push('Shahar'); if(!$('#addr').value.trim())need.push('Manzil'); if(!$('#date').value||!$('#time').value)need.push('Sana/Vaqt');
  if(need.length){const e=$('#err'); e.style.display='block'; e.textContent='Majburiy: '+need.join(', '); return false}
  $('#err').style.display='none'; return true;
}

function sendOrder(){
  if(!validate())return;
  const o={id:'o_'+Date.now(),type:'worker',service:$('#svc').value,city:$('#city').value,addr:$('#addr').value,date:$('#date').value,time:$('#time').value,hours:$('#hours').value,note:$('#note').value,gps:GPS,images:uploads,status:'pending',accepts:[]};
  const all=JSON.parse(localStorage.getItem('ps_orders')||'[]'); all.unshift(o); localStorage.setItem('ps_orders',JSON.stringify(all));
  CURRENT_ORDER=o.id; $('#toOffers').disabled=false; $('#toOffers').removeAttribute('title'); toast('Buyurtma yuborildi ‚úÖ'); simulateAccepts(o);
}
$('#send').onclick=sendOrder;

$('#toOffers').onclick=()=>{if(!CURRENT_ORDER){toast('Avval buyurtma yuboring');return} renderOffers(CURRENT_ORDER)}

/* Simulate worker accepts (faqat e‚Äôlon berganda ko‚Äòrinadi) */
function simulateAccepts(o){
  const near=WORKERS.filter(w=>w.city===o.city&&(w.cat===o.service||o.service==='boshqa'));
  let t=900; near.forEach(w=>{ if(Math.random()>0.3){ setTimeout(()=>{ const list=JSON.parse(localStorage.getItem('ps_orders')||'[]'); const ord=list.find(x=>x.id===o.id); if(!ord)return; const dist=(Math.random()*4+0.5).toFixed(1); if(!(ord.accepts||[]).some(a=>a.id===w.id)) ord.accepts.push({...w,dist}); localStorage.setItem('ps_orders',JSON.stringify(list)); if(o.id===CURRENT_ORDER) renderOffers(o.id); }, t); t+=1000+Math.random()*1000; }});
}

function renderOffers(orderId){
  const list=JSON.parse(localStorage.getItem('ps_orders')||'[]'); const o=list.find(x=>x.id===orderId);
  const arr=o?.accepts||[]; $('#offersEmpty').style.display=arr.length?'none':'block';
  $('#offers').innerHTML=arr.map(w=>`<article class="item"><div class="avatar">üë§</div><div class="meta"><h4>${w.name} ‚Ä¢ ${tagSvc(w.cat)}</h4><div><span class="badge">‚≠ê ${w.rating}</span><span class="badge">${w.city}</span><span class="badge">${toMoney(w.price)} ${w.unit}</span><span class="badge">Masofa: ${w.dist} km</span></div><div class="actions"><button class="btn primary" onclick="chooseWorker('${o.id}','${w.id}')">Tanlash</button></div></div></article>`).join('');
}
function chooseWorker(orderId,workerId){
  const all=JSON.parse(localStorage.getItem('ps_orders')||'[]'); const o=all.find(x=>x.id===orderId); if(!o)return;
  const w=(o.accepts||[]).find(a=>a.id===workerId); o.status='assigned'; o.assignee=w; localStorage.setItem('ps_orders',JSON.stringify(all));
  toast(`Tanlandi: ${w.name}`); renderOffers(orderId);
}

/* init */
(function(){
  // agar index.html dan pref bilan kelingan bo‚Äòlsa
  const u=new URL(location.href); const pref=u.searchParams.get('pref'); if(pref)$('#svc').value=pref;
})();

/* SW */
if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js'); }
</script>
</body>
                                                   </html>
