<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<link rel="manifest" href="manifest.json">
<title>PROSTAFF</title>
<meta name="theme-color" content="#f59e0b"/>
<style>
  :root{
    --brand:#f59e0b; --brand-2:#f8c35b; --ink:#0f172a; --muted:#64748b;
    --bg:#ffffff; --card:#fff6e5; --shadow:0 8px 24px rgba(15,23,42,.08);
    --radius:16px;
  }
  *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  a{color:inherit;text-decoration:none}
  .app{min-height:100dvh;display:grid;grid-template-rows:auto 1fr auto}
  .container{width:min(980px,100%);margin:0 auto;padding:18px}
  .title{font-weight:800;letter-spacing:.8px;text-align:center;font-size:28px}
  .pill{display:block;width:100%;border-radius:20px;padding:18px 22px;background:var(--card);
        box-shadow:var(--shadow);text-align:center;font-weight:700;font-size:18px}
  .grid{display:grid;gap:16px}
  .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  @media (max-width:700px){.grid.cols-2{grid-template-columns:1fr}}
  .search{display:flex;gap:10px;align-items:center;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:32px;padding:10px 14px}
  .search input{flex:1;border:0;background:transparent;outline:none;font-size:16px}
  .chips{display:flex;gap:10px;overflow:auto;padding-bottom:6px}
  .chip{min-width:86px;text-align:center;border-radius:18px;padding:10px 12px;background:#fff;border:1px solid #e5e7eb;box-shadow:0 2px 8px rgba(0,0,0,.03)}
  .hero{background:linear-gradient(180deg,#fff3d1,#fff);border-radius:20px;padding:18px;box-shadow:var(--shadow)}
  .hero h3{margin:0 0 6px;font-size:20px}
  .muted{color:var(--muted)}
  .btn{appearance:none;border:0;border-radius:14px;background:var(--ink);color:#fff;padding:12px 16px;font-weight:700;box-shadow:var(--shadow);cursor:pointer}
  .btn.secondary{background:#fff;color:var(--ink);border:1px solid #e5e7eb}
  .btn.brand{background:var(--brand)}
  .safe{position:sticky;bottom:0;inset-inline:0;background:linear-gradient(180deg,transparent,rgba(255,255,255,.9) 20%, #fff 60%);padding:14px 18px}
  /* NAV */
  .nav{display:flex;justify-content:space-between;gap:6px;background:#fff;border-top:1px solid #e5e7eb}
  .nav a{flex:1;text-align:center;padding:12px 0}
  .nav .on{color:var(--brand);font-weight:700}
  /* PAGES (views) */
  .view{display:none;animation:fade .18s ease}
  .view.show{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(6px)}}
  /* FORMS */
  .card{background:#fff;border:1px solid #eaeaea;border-radius:18px;box-shadow:var(--shadow);padding:16px}
  label{display:block;font-weight:600;margin:14px 6px 6px}
  .input,.select,.textarea{width:100%;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#f9fafb}
  .select{appearance:none}
  .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  @media (max-width:720px){.row{grid-template-columns:1fr}}
  .gallery{display:flex;gap:10px;overflow:auto}
  .gallery img{height:84px;width:110px;object-fit:cover;border-radius:12px;border:1px solid #eee}
  /* list cards */
  .firm{display:grid;grid-template-columns:64px 1fr;gap:12px;align-items:center;padding:14px;border:1px solid #eee;border-radius:16px;background:#fff;box-shadow:var(--shadow)}
  .logo{height:54px;width:54px;border-radius:14px;background:var(--card);display:grid;place-items:center;font-size:24px}
  .tag{display:inline-flex;align-items:center;gap:6px;background:#f3f4f6;border:1px solid #e7e7e7;border-radius:999px;padding:6px 10px;font-size:12px}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .hidden{display:none !important}
  .ok{color:#16a34a;font-weight:700}
  .warn{color:#e11d48;font-weight:700}
</style>
</head>
<body>
<div class="app" id="app">
  <!-- HEADER -->
  <header class="container">
    <div class="title">PROSTAFF</div>
  </header>

  <!-- MAIN -->
  <main class="container">

    <!-- HOME -->
    <section id="home" class="view show">
      <div class="grid cols-2" style="margin-bottom:14px">
        <a class="pill" href="#/workers">Kunlik ishchilar</a>
        <a class="pill" href="#/firms">Xizmat ko‚Äòrsatish firmalari</a>
      </div>

      <div class="search">
        <span>üîé</span>
        <input id="q" placeholder="Izlash (firma yoki xizmat)" />
        <button class="btn secondary" id="qGo">Qidir</button>
      </div>

      <div class="chips" style="margin:14px 0">
        <div class="chip">üßπ Tozalash</div>
        <div class="chip">üõ†Ô∏è Ta‚Äômirlash</div>
        <div class="chip">üöö Yuk tashish</div>
        <div class="chip">üåø Bog‚Äò-hovli</div>
        <div class="chip">‚Ä¶ Boshqa</div>
      </div>

      <div class="hero">
        <h3>Xizmat buyurtma qiling</h3>
        <div class="muted">
          Professional tozalash, ta‚Äômirlash, ko‚Äòchirish va boshqa xizmatlar.
          Yaqin atrofdagi ijrochilar 5‚Äì10 daqiqada taklif yuborishadi.
        </div>
        <div style="margin-top:12px;display:flex;gap:10px">
          <a class="btn brand" href="#/workers">Ishchi chaqirish</a>
          <a class="btn secondary" href="#/firms">Firmalarni ko‚Äòrish</a>
        </div>
      </div>
    </section>

    <!-- WORKERS (ORDER) -->
    <section id="workers" class="view">
      <h2 style="margin:6px 0 12px">Buyurtma ‚Äî ishchi</h2>
      <form id="orderForm" class="card" autocomplete="on">
        <div class="row">
          <div>
            <label>Xizmat turi</label>
            <select class="select" name="service" required>
              <option>Yuvish</option>
              <option>Remontdan keyingi tozalash</option>
              <option>Oyna/pol yuvish</option>
              <option>Yuk ko‚Äòtarish</option>
              <option>Ko‚Äòchirish (gazel+brigada)</option>
              <option>Usta (elektrik/santexnik)</option>
              <option>Boshqa</option>
            </select>
          </div>
          <div>
            <label>Shahar / hudud</label>
            <select class="select" name="city" required>
              <option>Toshkent</option><option>Samarqand</option>
              <option>Farg‚Äòona</option><option>Navoiy</option>
              <option>Andijon</option><option>Buxoro</option>
            </select>
          </div>
        </div>

        <label>Manzil (aniq joy)</label>
        <div class="row">
          <input class="input" name="addr" placeholder="Ko‚Äòcha, uy, orientir" required>
          <button type="button" class="btn secondary" id="gpsBtn">üìç GPS</button>
        </div>
        <div id="gpsTxt" class="muted" style="margin-top:6px">GPS: ‚Äì</div>

        <div class="row" style="margin-top:10px">
          <div>
            <label>Sana</label>
            <input class="input" type="date" name="date" required>
          </div>
          <div>
            <label>Boshlanish vaqti</label>
            <input class="input" type="time" name="time" required>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Davomiylik (soat)</label>
            <select class="select" name="hours">
              <option>2</option><option selected>4</option><option>6</option><option>8</option>
            </select>
          </div>
          <div>
            <label>Ishchilar soni</label>
            <select class="select" name="count">
              <option>1</option><option selected>2</option><option>3</option><option>4</option><option>5</option>
            </select>
          </div>
        </div>

        <label>Rasm(lar)ni yuklang (ixtiyoriy)</label>
        <input class="input" type="file" id="imgs" multiple accept="image/*">
        <div id="thumbs" class="gallery" style="margin-top:8px"></div>

        <label>Qo‚Äòshimcha izoh</label>
        <textarea class="textarea" name="note" rows="3" placeholder="kv.m, eshik/kalit, hayvon va hokazo"></textarea>

        <label class="muted" style="display:flex;gap:10px;align-items:center">
          <input type="checkbox" id="agree" required>
          <span>Shaxsiy ma‚Äôlumotlarni qayta ishlashga roziman</span>
        </label>

        <div class="safe">
          <div style="display:flex;gap:10px;justify-content:space-between;flex-wrap:wrap">
            <button type="button" class="btn secondary" id="offersBtn">Tushgan takliflar</button>
            <button class="btn brand" type="submit">Buyurtmani yuborish</button>
          </div>
        </div>
      </form>

      <div id="offersCard" class="card hidden" style="margin-top:14px">
        <h3 style="margin:0 0 8px">Takliflar</h3>
        <div id="offersList" class="grid"></div>
        <div class="muted" id="offersEmpty">Hozircha taklif yo‚Äòq. Buyurtma yuborilgach, yaqin atrofdagi ishchilar ko‚Äòradilar va roziligi bilan taklif qoldirishadi.</div>
      </div>
    </section>

    <!-- FIRMS LIST -->
    <section id="firms" class="view">
      <h2 style="margin:6px 0 12px">Firmalar</h2>
      <div class="grid" id="firmList"></div>
    </section>

    <!-- FIRM DETAIL (modal-like card) -->
    <section id="firmDetail" class="view">
      <a class="muted" href="#/firms">‚Üê Orqaga</a>
      <div id="firmCard" class="card" style="margin-top:10px"></div>
    </section>

  </main>

  <!-- NAV -->
  <nav class="nav container">
    <a data-to="#/home" id="nav-home" class="on">üè† Bosh sahifa</a>
    <a data-to="#/workers" id="nav-workers">üë∑ Ishchilar</a>
    <a data-to="#/firms" id="nav-firms">üè¢ Firmalar</a>
    <a data-to="#/offers" id="nav-offers">üìÖ Buyurtmalar</a>
  </nav>
</div>

<script>
/* ---------- Mini Router (hash) ---------- */
const routes = ["#/home","#/workers","#/firms","#/firm","#/offers"];
const el = id=>document.getElementById(id);
const views = {home:el("home"), workers:el("workers"), firms:el("firms"), firmDetail:el("firmDetail")};

function show(view){
  Object.values(views).forEach(v=>v.classList.remove("show"));
  view.classList.add("show");
  // nav on state
  document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('on'));
  if(location.hash.startsWith("#/workers")) el("nav-workers").classList.add("on");
  else if(location.hash.startsWith("#/firms")) el("nav-firms").classList.add("on");
  else if(location.hash.startsWith("#/home")||location.hash==="") el("nav-home").classList.add("on");
  else el("nav-offers").classList.add("on");
}

function route(){
  const h = location.hash || "#/home";
  if(h.startsWith("#/workers")) show(views.workers);
  else if(h.startsWith("#/firms")) show(views.firms);
  else if(h.startsWith("#/firm/")) { renderFirmDetail(h.split("/")[2]); show(views.firmDetail); }
  else show(views.home);
}
addEventListener("hashchange", route); addEventListener("load", route);
document.querySelectorAll(".nav a").forEach(a=>a.onclick=(e)=>{e.preventDefault();location.hash=a.dataset.to;});

/* ---------- Mock data (firmalar) ---------- */
const firms = [
  {id:"cleanpro", name:"CleanPro LLC", cat:"Tozalash", city:"Toshkent", price:"450 000 / xona", rating:4.9,
   badges:["Sertifikatli","24/7"], imgs:["https://images.unsplash.com/photo-1581578731548-c64695cc6952?q=80&w=800","https://images.unsplash.com/photo-1584624278909-1e4d4c5d3c3b?q=80&w=800"],
   about:"Professional tozalash kompaniyasi. Remontdan keyingi, ofis va uy tozalash."},
  {id:"masterfix", name:"MasterFix", cat:"Ta‚Äômirlash", city:"Samarqand", price:"soatiga 120 000", rating:4.7,
   badges:["Kafolat 14 kun"], imgs:["https://images.unsplash.com/photo-1581091870627-3b5fef3c6b3a?q=80&w=800","https://images.unsplash.com/photo-1581092912881-5a6a1b08d4a6?q=80&w=800"],
   about:"Elektrik, santexnik, mebel yig‚Äòish ‚Äî tez va sifatli."},
  {id:"moveit", name:"MoveIt Team", cat:"Ko‚Äòchirish", city:"Toshkent", price:"1 800 000 / smena", rating:4.8,
   badges:["Gazel","Brigada"], imgs:["https://images.unsplash.com/photo-1581093588401-16b1d13fc1c3?q=80&w=800","https://images.unsplash.com/photo-1581091012184-5c4b0b8b5cfe?q=80&w=800"],
   about:"Ko‚Äòchirish, yuk ko‚Äòtarish, qadoqlash xizmatlari."}
];

function renderFirms(){
  const wrap = el("firmList"); wrap.innerHTML="";
  firms.forEach(f=>{
    const d = document.createElement('div');
    d.className = "firm";
    d.innerHTML = `
      <div class="logo">üè¢</div>
      <div>
        <div style="display:flex;justify-content:space-between;gap:10px;align-items:center">
          <div style="font-weight:800">${f.name}</div>
          <span class="tag">‚≠ê ${f.rating}</span>
        </div>
        <div class="tags" style="margin:6px 0">
          <span class="tag">${f.cat}</span>
          <span class="tag">${f.city}</span>
          <span class="tag">${f.price}</span>
        </div>
        <div style="display:flex;gap:10px;margin-top:6px">
          <a class="btn secondary" href="#/firm/${f.id}">Batafsil</a>
          <a class="btn brand" href="#/workers">Buyurtma</a>
        </div>
      </div>`;
    wrap.appendChild(d);
  });
}
renderFirms();

function renderFirmDetail(id){
  const f = firms.find(x=>x.id===id);
  const c = el("firmCard");
  if(!f){ c.innerHTML="<div class='warn'>Topilmadi</div>"; return; }
  c.innerHTML = `
    <div class="grid">
      <div class="gallery">
        ${f.imgs.map(src=>`<img loading="lazy" src="${src}" alt="">`).join("")}
      </div>
      <div>
        <h2 style="margin:8px 0">${f.name}</h2>
        <div class="tags">
          <span class="tag">‚≠ê ${f.rating}</span>
          <span class="tag">${f.cat}</span>
          <span class="tag">${f.city}</span>
          <span class="tag">${f.price}</span>
          ${f.badges.map(b=>`<span class="tag">‚úÖ ${b}</span>`).join("")}
        </div>
        <p style="margin:12px 0" class="muted">${f.about}</p>
        <div style="display:flex;gap:10px">
          <a class="btn secondary" href="#/firms">Ro‚Äòyxatga qaytish</a>
          <a class="btn brand" href="#/workers">Bu firma uchun buyurtma</a>
        </div>
      </div>
    </div>`;
}

/* ---------- Order form (privacy rule & offers) ---------- */
const LS_KEY = "prostaff_orders";
const OFFERS_KEY = "prostaff_offers";

const gpsBtn = el("gpsBtn"), gpsTxt = el("gpsTxt"), form = el("orderForm");
gpsBtn?.addEventListener("click", ()=>{
  if(!navigator.geolocation){ gpsTxt.textContent="GPS: qurilmada yo‚Äòq"; return; }
  gpsTxt.textContent="GPS: aniqlanmoqda‚Ä¶";
  navigator.geolocation.getCurrentPosition(pos=>{
    const {latitude, longitude} = pos.coords;
    gpsTxt.textContent = `GPS: ${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;
    form.dataset.gps = `${latitude},${longitude}`;
  }, _=> gpsTxt.textContent="GPS: ruxsat berilmadi");
});

document.getElementById("imgs").addEventListener("change", e=>{
  const box = el("thumbs"); box.innerHTML="";
  [...e.target.files].slice(0,6).forEach(f=>{
    const img = document.createElement("img");
    img.src = URL.createObjectURL(f);
    box.appendChild(img);
  });
});

// only show workers list right after an order exists (privacy rule)
function userHasActiveOrder(){
  const o = JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  return o.length>0;
}

el("offersBtn").addEventListener("click", ()=> {
  if(!userHasActiveOrder()){
    alert("Hozircha buyurtma yo‚Äòq. Avval buyurtma yuboring ‚Äî keyin tushgan takliflarni ko‚Äòrasiz.");
    return;
  }
  document.getElementById("offersCard").classList.remove("hidden");
  renderOffers();
});

form.addEventListener("submit", (e)=>{
  e.preventDefault();
  const fd = new FormData(form);
  const order = Object.fromEntries(fd.entries());
  order.gps = form.dataset.gps||"";
  order.id = "o"+Date.now();
  // save
  const all = JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  all.unshift(order);
  localStorage.setItem(LS_KEY, JSON.stringify(all));
  // mock: generate 2-4 fake offers from nearby workers
  const workers = ["Jasur","Umid","Dilshod","Bekzod","Aziza","Sardor"];
  const offers = Array.from({length:Math.floor(Math.random()*3)+2}).map((_,i)=>({
    id:"w"+(Date.now()+i),
    name: workers[Math.floor(Math.random()*workers.length)],
    rating: (4+Math.random()).toFixed(1),
    price: (150+Math.floor(Math.random()*70))+" ming/soat",
    eta: (5+Math.floor(Math.random()*8))+" daqiqa ichida keladi",
    orderId: order.id
  }));
  localStorage.setItem(OFFERS_KEY, JSON.stringify(offers));
  // reset UI
  form.reset(); el("thumbs").innerHTML=""; form.dataset.gps="";
  alert("Buyurtmangiz yuborildi! Yaqin daqiqalarda takliflar tushadi.");
  document.getElementById("offersCard").classList.remove("hidden");
  renderOffers();
});

function renderOffers(){
  const wrap = el("offersList");
  const offers = JSON.parse(localStorage.getItem(OFFERS_KEY)||"[]");
  wrap.innerHTML="";
  el("offersEmpty").style.display = offers.length? "none":"block";
  offers.forEach(of=>{
    const d = document.createElement('div'); d.className="card";
    d.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div style="display:flex;gap:10px;align-items:center">
          <div class="logo">üë∑</div>
          <div>
            <div style="font-weight:800">${of.name}</div>
            <div class="muted">‚≠ê ${of.rating} ¬∑ ${of.eta}</div>
          </div>
        </div>
        <div style="text-align:right">
          <div class="ok">${of.price}</div>
          <div style="margin-top:8px">
            <button class="btn brand" data-choose="${of.id}">Tanlash</button>
          </div>
        </div>
      </div>`;
    wrap.appendChild(d);
  });
  // choose buttons
  wrap.querySelectorAll("[data-choose]").forEach(b=>b.onclick=()=>{
    const id=b.dataset.choose;
    const offers=JSON.parse(localStorage.getItem(OFFERS_KEY)||"[]");
    const pick = offers.find(x=>x.id===id);
    if(!pick) return;
    alert(`Tabriklaymiz! ${pick.name} tanlandi.\nBog‚Äòlanish yuborildi.`);
    // after choose: clear offers but keep order history
    localStorage.removeItem(OFFERS_KEY);
    renderOffers();
  });
}

/* ---------- Search (home) ---------- */
document.getElementById("qGo").addEventListener("click", ()=>{
  const q = (document.getElementById("q").value||"").toLowerCase();
  location.hash="#/firms";
  // quick filter
  setTimeout(()=>{
    const list = el("firmList").children;
    [...list].forEach(card=>{
      const text = card.innerText.toLowerCase();
      card.style.display = text.includes(q) ? "" : "none";
    });
  },50);
});

/* ---------- PWA ---------- */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').catch(()=>{});
}
</script>
</body>
          </html>
